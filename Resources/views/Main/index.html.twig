{% extends "KyelaBundle::layout.html.twig" %}

{% block body %}

<ul class="list-group">
{% for event in events %}
	<li class="list-group-item">
		<a href="{{ path('event_edit', {'id': event.id}) }}">
			<span class="glyphicon glyphicon-edit"></span>
		</a>
		<span class="badge">{{ event.participationsscore }}</span>
		{{ event.datetime|localizeddate('medium', 'none', app.request.locale, null, "cccc d MMMM h'h'mm") }}&nbsp;: {{ event.name }}
	</li>
{% endfor %}
</ul>

<div class="table-responsive">
	<table class="table table-striped table-hover table-bordered table-condensed">
		<thead>
			<tr>
				<th>{% trans %}participant{% endtrans %}</th>
				{% for event in events %}
					<th data-cell-key="{{ event.id }}">
						{{ event.datetime|localizeddate('medium', 'none', app.request.locale, null, "d MMM h'h'mm") }}
					</th>
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% for participant in participants %}
			<tr>
				<td data-cell-key="{{ participant.id }}">
					<a href="{{ path('participant_edit', {'id': participant.id}) }}">
						<span class="glyphicon glyphicon-edit"></span>
					</a>
					{{ participant.name }}
				</td>
				{% for event in events %}
					{% set accessKey = event.id ~ '-' ~ participant.id %}
					<td{% if attribute(participations, accessKey) is defined %} style="background-color:{{ attribute(participations, accessKey).choice.color }}"{% endif %}>
						<div class="btn-group">
							<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
								{{ attribute(participations, accessKey) is defined ? attribute(participations, accessKey).choice : '-' }}
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu">
								{%  for choice in choices %}
									<li>
										{% set parameters = {'event': event.id, 'participant': participant.id, 'choice': choice.id} %}
										{% if attribute(participations, accessKey) is defined %}
										<a href="{{ path('participation_edit', parameters|merge({'id': attribute(participations, accessKey).id})) }}">
										{% else %}
										<a href="{{ path('participation_new', parameters) }}">
										{% endif %}
											{{ choice.name }}
										</a>
									</li>
								{% endfor %}
								{% if attribute(participations, accessKey) is defined %}
								<li>
									<a href="{{ path('participation_delete', {'id': attribute(participations, accessKey).id}) }}">
										<span class="glyphicon glyphicon-trash"></span>
									</a>
								</li>
								{% endif %}
							</ul>
						</div>
					</td>
				{% endfor %}
			</tr>
			{% endfor %}
		</tbody>
		<tfoot>
			<tr>
				<th>Total</th>
				{% for event in events %}
					<th>
						{{ event.participationsscore }}
					</th>
				{% endfor %}
			</tr>
		</tfoot>
	</table>
</div>

<p>
	<a class="btn btn-primary btn-lg" role="button" href="{{ path('participant_new') }}">
		<span class="glyphicon glyphicon-user"></span>
		{% trans %}add.a.participant{% endtrans %}
	</a>
	<a class="btn btn-success btn-lg" role="button" href="{{ path('event_new') }}">
		<span class="glyphicon glyphicon-plus"></span>
		{% trans %}add.a.date{% endtrans %}
	</a>
	<a class="btn btn-warning btn-lg" role="button" href="{{ path('choice') }}">
		<span class="glyphicon glyphicon-edit"></span>
		{% trans %}edit.options{% endtrans %}
	</a>
</p>

{% endblock %}
